{% extends "_layout.html" %}

{% block content %}

{% with messages = get_flashed_messages() %}
{% if messages %}
<ul class=flashes>
    {% for message in messages %}
    <p class="flash-words">{{ message }} </p>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}

<main>
    <div class=container-fluid>
        <div id="payment"></div>
        <button id="braintree-button">Confirm payment details</button>
        <form method="POST" action="{{url_for('payment.create')}}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" name="nonce" id="nonce-field">
            <input type="submit" value="Make donation now">
        </form>
    </div>

    <script type="text/javascript">
        const braintreeButton = document.getElementById("braintree-button")

        braintree.dropin.create({
            container: document.getElementById("payment"),
            authorization: "{{token}}"
        }, (error, paymentForm) => {
            braintreeButton.onclick = () => {
                paymentForm.requestPaymentMethod((error, payload) => { document.getElementById("nonce-field").value = payload.nonce })
            }
        })

    </script>

</main>

{% endblock %}